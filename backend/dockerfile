# Use Tomcat as the base image, since it can run .war files
# FROM tomcat:9.0-jdk17

# Remove default webapps (optional)
# RUN rm -rf /usr/local/tomcat/webapps/*

# Copy the WAR file to the Tomcat webapps directory
# ARG WAR_FILE=target/*.war
# COPY ${WAR_FILE} /usr/local/tomcat/webapps/ROOT.war
# COPY target/backend-0.0.1-SNAPSHOT.war /usr/local/tomcat/webapps/ROOT.war
# COPY target/backend-0.0.1-SNAPSHOT.war /usr/local/tomcat/webapps/ExpenseWise.war

# Expose the default Tomcat port
# EXPOSE 8080

# Command to run Tomcat
# CMD ["catalina.sh", "run"]

# ENV DB_HOST=localhost
# ENV DB_PORT=3306
# ENV DB_NAME=expenses
# ENV DB_USERNAME=root
# ENV DB_PASSWORD='Frenchfries@2005'

## -------- Build stage --------
FROM maven:3.9-eclipse-temurin-17 AS build
WORKDIR /app
COPY pom.xml .
COPY src ./src
# Build the application (skip tests for faster builds; remove -DskipTests to run tests)
RUN mvn -q -DskipTests clean package

## -------- Runtime stage --------
FROM eclipse-temurin:17-jre
WORKDIR /ExpenseWise

# Copy the built jar from the build stage
COPY --from=build /app/target/*SNAPSHOT.jar /ExpenseWise/backend.jar

# Default Spring Boot port (configured in application.properties)
EXPOSE 3001

# Spring Boot will honor SERVER_PORT env var if provided
ENTRYPOINT ["java", "-jar", "backend.jar"]
